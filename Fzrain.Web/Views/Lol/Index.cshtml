@using Fzrain.Core.Domain.Lol
@using Fzrain.Web.Framework.Theme
@using Fzrain.Web.Models.Lol
@{
    ViewBag.Title = "Index";
    Layout = "../Shared/_LayoutEmpty.cshtml";
}

<header>
    <div class="container" class="row">
        <h1 class="col-sm-3 hidden-sm">FZRAIN云开发平台</h1>

        <div id="configurator-wrap" class="col-sm-9 hidden-xs">
            <div id="configurator" class="row">
                <label class="col-sm-4">
                    <div class="description">界面风格</div>
                    <select id="dimensions"></select>

                </label>

                <label class="col-sm-4">
                    <div class="description">控件样式</div>
                    <select id="theme"></select>
                </label>

                <label class="col-sm-4">
                    <div class="description">字体大小</div>
                    <select id="font-size"></select>
                </label>
            </div>
        </div>
    </div>
</header>

<div id="example" class="container">
    <ul id="menu">
        <li>@Html.ActionLink("战绩首页", "index")</li>
        <li>@Html.ActionLink("英雄统计", "ShowChampionInfo", new { beginDate = "2014-10-19" })</li>
        <li>@Html.ActionLink("成长曲线", "ShowMyChampionInfos")</li>
    </ul>

    <div class="row clearfix">
        <div class="col-lg-4">
            <section id="profile" class="well">
                <h2 class="ra-well-title">个人信息</h2>

                <div class="row">
                    <div class="col-lg-5 col-sm-2">
                        <img src="/Content/lolpng/touxiang.png" style="width: 88px;margin-left:10px" />
                    </div>

                    <div class="col-lg-7 col-sm-2">
                        <span class="ra-first-name">雷瑟守备</span>
                        <span class="ra-last-name">网络中断突然</span>

                    </div>
                </div>
            </section>
        </div>

        <div class="col-lg-8">
            <div id="tabstrip" class="ra-section">
                <ul>
                    <li class="k-state-active"><span class="km-icon revenue"></span><span class="hidden-xs">战绩总览</span></li>
                    <li><span class="km-icon spd"></span><span class="hidden-xs">常用英雄</span></li>
                    <li><span class="km-icon spr"></span><span class="hidden-xs">擅长英雄</span></li>
                    <li><span class="km-icon share"></span><span class="hidden-xs">经典战役</span></li>
                </ul>
                <div>
                    <div style="width: 340px;float:left">
                        @(Html.Kendo().Chart()
                              .Name("chart1").Theme("metro")
                              .Series(series => series.Pie(new dynamic[]
                              {
                                  new {category = "ADC", value = 35},
                                  new {category = "中单", value = 25},
                                  new {category = "上单", value = 20},
                                  new {category = "打野", value = 10},
                                  new {category = "辅助", value = 10}
                              }))
                              .Tooltip(tooltip => tooltip
                                  .Visible(true).Template("#= category # - #= kendo.format('{0:P}', percentage)#(#= value #)"))
                        )

                    </div>
                    <div style="float: left;margin: 15px 0 0 150px;">
                        @(Html.Kendo().QRCode()
                        .Name("qrUrl")
                        .Value("fzrain@hotmail.com")
                        .ErrorCorrection(QRErrorCorrectionLevel.M)
                        .Size(120)
                        )
                    </div>
                </div>
                <div></div>
                <div></div>
                <div>

                </div>
            </div>
        </div>
    </div>



    <div class="ra-section" style="height:800px">
        @(Html.Kendo().Grid<Battle>()
            .Name("grid").Excel(c => c.FileName("data"))
            .Columns(columns =>
            {
                columns.Bound(u => u.ChampionId).ClientTemplate("<img width='50px' src='../../Content/lolpng/#=ChampionId#.png' alt='' />").Width(50).HtmlAttributes(new { style = "text-align:center" }).Filterable(filterable => filterable.UI("championFilter"));
                columns.Bound(u => u.ChampionId).Width(30).HeaderTemplate("Id").Filterable(false);
                columns.Bound(u => u.BattleType).Width(80).ClientTemplate("#=showGameType(BattleType)#");
                columns.Bound(u => u.StartTime).Width(80).Format("{0:yyyy-MM-dd HH:mm:ss}");
                columns.Bound(u => u.Duration).Width(80).ClientTemplate("#=(Duration/60).toFixed(2)#");
                columns.Bound(u => u.IsWin).Width(80).ClientTemplate("#=showWinStatus(IsWin)#");
                columns.Bound(u => u.ContributeOrder).Width(80).ClientTemplate("#=RenderContribute(ContributeOrder)#");
                columns.Command(c => c.Custom("战斗详情").Click("showDetails")).Width(80);
            })
            .ToolBar(c => c.Custom().Text("更新战绩").HtmlAttributes(new { id = "updateBattle" }))
            .Pageable(c => c.PageSizes(true).Messages(m => m.Next("下一页").ItemsPerPage("每页记录数")).Refresh(true))
            .Filterable(filterable => filterable
            .Extra(false))
            .Scrollable().Sortable()
            .HtmlAttributes(new { style = "height:100%;" })
            .DataSource(dataSource => dataSource
                .Ajax()
                .PageSize(20)

                .Model(model => model.Id(u => u.Id))
                        .Read(read => read.Action("Read", "Lol"))

            )
        )
    </div>

    <style>
        .figurePhoto p {
            position: absolute;
            visibility: hidden;
        }

        .figurePhoto:hover p {
            visibility: visible;
            position: absolute;
            width: 178px;
            height: 100px;
            top: 20px;
            margin: 0;
            padding: 0;
            line-height: 100px;
            vertical-align: middle;
            text-align: center;
            color: #fff;
            cursor: pointer;
            background-color: rgba(0,0,0,0.75);
            transition: background .2s linear, color .2s linear;
            -moz-transition: background .2s linear, color .2s linear;
            -webkit-transition: background .2s linear, color .2s linear;
            -o-transition: background .2s linear, color .2s linear;
        }
    </style>
    <section id="gallery" class="well">
        <h2 class="ra-well-title">精彩截图<span style="float:right"><a href="#">更多></a> </span></h2>

        <script id="listview-template" type="x-kendo-template">
            <div class="col-xs-6 col-md-4 col-lg-2">
                <figure class="figurePhoto">
                    <img src="assets/photos/#= Uri #" class="img-responsive" />
                    <h4>#: Name #</h4>
                    <p class="hidden-sm">
                        查看大图
                    </p>
                </figure>
            </div>
        </script>
        <div id="listview" class="ra-well-overlay row"></div>

    </section>



    <footer>Copyright &copy; 2013 <a href="http://telerik.com/">Telerik Inc</a>. All rights reserved.</footer>
</div>

@(Html.Kendo().Window()
        .Name("window").Visible(false)
          .Title("弹出页").Content(@<text>
            @Html.Kendo().TextBox().Name("txtQQ").Value("250970574")
            @{
                var areaInfo = new List<DropDownListItem>
                {
                    new DropDownListItem{Text ="雷瑟守备",Value ="11"},
                    new DropDownListItem { Text ="皮城警备",Value ="27"}
                };
            }
            @Html.Kendo().DropDownList().BindTo(areaInfo).Name("areaId")
            @Html.Kendo().TextBox().Name("myRoleName").Value("网络中断突然")
            @Html.Kendo().Button().Content("获取更新").Name("GetUpdateData").Events(e => e.Click("GetUpdateBattles"))
            @Html.Kendo().Button().Content("更新").Name("update").Events(e => e.Click("updateAllbattle"))
            <input type="hidden" id="ids" />
            <div id="content"></div>
        </text>)
        .Draggable()
        .Modal(true)
        .Width(600).Height(400)
        .Actions(actions => actions.Minimize().Maximize().Close()).Position(a => a.Left(335).Top(100))
)

@(Html.Kendo().Window()
        .Name("window2").Visible(false)
          .Title("战斗详情")
    .Draggable()
    .Modal(true)
    .Width(700).Height(470)
    .Actions(actions => actions.Minimize().Maximize().Close()).Position(a => a.Left(335).Top(100))
)
<script type="text/javascript">
    $("#dimensions").kendoDropDownList({
        dataTextField: "text",
        dataValueField: "value",
        value: "@ThemeSetting.CurrentDimensions",
        dataSource: [
            { text: "Default", value: "common" },
            { text: "Bootstrap", value: "common-bootstrap" },
            { text: "Material", value: "common-material" }
        ],
        change: function () {
            $.cookie("Dimensions", this.value(), { expiresAt: new Date(2099, 1, 1) });
            window.location.reload();
        }
    });

    $("#theme").kendoDropDownList({
        dataTextField: "text",
        dataValueField: "value",
        value: "@ThemeSetting.CurrentTheme",
        dataSource: [
            { text: "Default", value: "default" },
            { text: "Blue Opal", value: "blueopal" },
            { text: "Bootstrap", value: "bootstrap" },
            { text: "Silver", value: "silver" },
            { text: "Uniform", value: "uniform" },
            { text: "Metro", value: "metro" },
            { text: "Black", value: "black" },
            { text: "Material", value: "material" },
            { text: "Metro Black", value: "metroblack" },
            { text: "High Contrast", value: "highcontrast" },
            { text: "Moonlight", value: "moonlight" },
            { text: "Flat", value: "flat" }
        ],
        change: function () {
            $.cookie("theme", this.value(), { expiresAt: new Date(2099, 1, 1) });
            window.location.reload();
        }
    });
    //切换字体大小
    function changeFontSize() {
        var value = $("#font-size").kendoDropDownList("value");
        $("body").css("font-size", value + "px");
    }
    $("#font-size").kendoDropDownList({
        dataTextField: "text",
        dataValueField: "value",
        value: 14,
        height: 204,
        dataSource: [
            { text: "10px", value: 10 },
            { text: "12px", value: 12 },
            { text: "14px", value: 14 },
            { text: "16px", value: 16 },
            { text: "18px", value: 18 },
            { text: "20px", value: 20 }
        ],
        change: changeFontSize
    });
    changeFontSize();

    $("#menu").kendoMenu();

    function resizeTabStripContent() {
        kendo.resize("#tabstrip");
    }

    $("#tabstrip").kendoTabStrip({
        animation: {
            open: { effects: "fadeIn" }
        }
    });

    // resize nested charts when window resizes
    $(window).resize(resizeTabStripContent);

   
    $("#listview").kendoListView({         
        dataSource: {
            transport: {
                read: {
                    url: "@Url.Action("GetPictures", "lol")",
                type:"post",
                async: false
            }
        }
              
    },
        template: $("#listview-template").html()
    });
    $("#updateBattle").bind("click", function () {
        $("#window").data("kendoWindow").open();
        return false;
    });


    $(".img-responsive").parent().children("p").click(function () {
        open($(this).parent().children("img").prop("src"))
    });
</script>

<script type="text/javascript">

    function GetUpdateBattles() {
        $.post("/Lol/WaitUpdate", { qq: $("#txtQQ").val(), areaId: $("#areaId").val() }, function (data) {
            $("#ids").val(data);
            for (var i = 0; i < data.length; i++) {
                $("#content").append("<p>" + data[i] + "<p/>");
            }

        });
    }
    function showDetails(e) {
        e.preventDefault();
        var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
        var kendoWindow = $("#window2").data("kendoWindow");
        $.post("/Lol/GetBattleDetail", { GameId: dataItem.GameId }, function (data) {

            kendoWindow.content(data);
            kendoWindow.center().open();
        });


    }

    function updateAllbattle() {
        $.post("Lol/UpdateBattle", { ids: $("#ids").val(), areaId: $("#areaId").val(), myRoleName: $("#myRoleName").val() }, function (data) {
            if (data === "ok") {
                kendo.alert("更新成功！");
                $("#window").data("kendoWindow").close();
            }

        });
    }

    function showGameType(gameType) {
        if (gameType == "6") {
            return "极地大乱斗";
        } else {
            return "召唤师峡谷";
        }
    }

    function showWinStatus(isWin) {
        if (isWin == "1") {
            return "<font color='green'>胜利</font>";
        } else {
            return "<font color='red'>失败</font>";
        }
    }

    function RenderContribute(contributeOrder) {
        if (contributeOrder == 1) {
            return "<img height='40px' src='../../Content/mvp.png' alt='' />";
        } else {
            return contributeOrder;
        }
    }


    function championFilter(element) {
        element.kendoComboBox({
            dataSource: {
                transport: {
                    read: "@Url.Action("FilterMenuChampion")"
                }
            },
            template: "<img width='50px' src='../../Content/lolpng/#:data#.png' alt='' />"
        });
    }
</script>